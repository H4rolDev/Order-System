<app-admin-sidebar></app-admin-sidebar>
<div class="container">
  <div class="header">
    <h1>üì¶ Gesti√≥n de Productos</h1>
  </div>

  <div class="content">
    <!-- Mensajes de estado -->
    <div class="message-container">
      <div *ngIf="successMessage" class="alert alert-success">
        <i class="icon">‚úÖ</i>
        {{ successMessage }}
      </div>
      <div *ngIf="errorMessage" class="alert alert-error">
        <i class="icon">‚ùå</i>
        {{ errorMessage }}
      </div>
    </div>

    <!-- Formulario -->
    <div class="form-section">
      <h2 class="form-title">{{ formTitle }}</h2>
      <form (ngSubmit)="onSubmit()" #productFormRef="ngForm">
        <div class="form-row">
          <div class="form-group">
            <label for="name">Nombre del Producto:</label>
            <input
              type="text"
              id="name"
              name="name"
              [(ngModel)]="productForm.name"
              required
              [disabled]="isLoading"
              placeholder="Ingresa el nombre del producto">
          </div>
          <div class="form-group">
            <label for="price">Precio:</label>
            <input
              type="number"
              id="price"
              name="price"
              [(ngModel)]="productForm.price"
              required
              min="0"
              step="0.01"
              [disabled]="isLoading"
              placeholder="0.00">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="priceDiscount">Precio con Descuento:</label>
            <input
              type="number"
              id="priceDiscount"
              name="priceDiscount"
              [(ngModel)]="productForm.priceDiscount"
              min="0"
              step="0.01"
              [disabled]="isLoading"
              placeholder="0.00">
          </div>
          <div class="form-group">
            <label for="stock">Stock:</label>
            <input
              type="number"
              id="stock"
              name="stock"
              [(ngModel)]="productForm.stock"
              required
              min="0"
              [disabled]="isLoading"
              placeholder="0">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="categoryId">Categor√≠a:</label>
            <select
              id="categoryId"
              name="categoryId"
              [(ngModel)]="productForm.categoryId"
              required
              [disabled]="isLoading">
              <option value="0">Selecciona una categor√≠a</option>
              <option *ngFor="let category of categories" [value]="category.id">
                {{ category.name }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label for="brandName">Marca:</label>
            <input
              type="text"
              id="brandName"
              name="brandName"
              [(ngModel)]="productForm.brandName"
              [disabled]="isLoading"
              placeholder="Nombre de la marca">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="storeName">Tienda:</label>
            <input
              type="text"
              id="storeName"
              name="storeName"
              [(ngModel)]="productForm.storeName"
              [disabled]="isLoading"
              placeholder="Nombre de la tienda">
          </div>
        </div>

        <div class="form-group">
          <label for="description">Descripci√≥n:</label>
          <textarea
            id="description"
            name="description"
            [(ngModel)]="productForm.description"
            [disabled]="isLoading"
            placeholder="Describe el producto..."></textarea>
        </div>

        <div class="form-actions">
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="isLoading || !productFormRef.form.valid">
            <span *ngIf="isLoading" class="spinner"></span>
            {{ submitButtonText }}
          </button>
          <button
            type="button"
            class="btn btn-secondary"
            (click)="cancelEdit()"
            [style.display]="isEditing ? 'inline-block' : 'none'"
            [disabled]="isLoading">
            ‚ùå Cancelar
          </button>
        </div>
      </form>
    </div>

    <!-- Filtros de b√∫squeda -->
    <div class="search-section">
      <h3>üîç Filtros de B√∫squeda</h3>
      <div class="filters-container">
        <div class="filter-row">
          <div class="form-group">
            <label for="searchName">Nombre:</label>
            <input
              type="text"
              id="searchName"
              placeholder="Buscar por nombre..."
              [(ngModel)]="searchFilters.name">
          </div>
          <div class="form-group">
            <label for="searchCategory">Categor√≠a:</label>
            <select
              id="searchCategory"
              [(ngModel)]="searchFilters.categoryId">
              <option value="">Todas las categor√≠as</option>
              <option *ngFor="let category of categories" [value]="category.id">
                {{ category.name }}
              </option>
            </select>
          </div>
        </div>

        <div class="filter-row">
          <div class="form-group">
            <label for="minPrice">Precio M√≠nimo:</label>
            <input
              type="number"
              id="minPrice"
              placeholder="0.00"
              [(ngModel)]="searchFilters.minPrice"
              min="0"
              step="0.01">
          </div>
          <div class="form-group">
            <label for="maxPrice">Precio M√°ximo:</label>
            <input
              type="number"
              id="maxPrice"
              placeholder="1000.00"
              [(ngModel)]="searchFilters.maxPrice"
              min="0"
              step="0.01">
          </div>
          <div class="form-group filter-actions">
            <button
              type="button"
              class="btn btn-primary"
              (click)="searchProducts()"
              [disabled]="isLoading">
              üîç Buscar
            </button>
            <button
              type="button"
              class="btn btn-secondary"
              (click)="clearSearch()"
              [disabled]="isLoading">
              üîÑ Limpiar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabla de productos -->
    <div class="table-section">
      <h2>üìã Lista de Productos</h2>

      <div *ngIf="isLoading" class="loading">
        <div class="spinner"></div>
        <span>Cargando productos...</span>
      </div>

      <div class="table-container" *ngIf="!isLoading && hasProducts">
        <table class="products-table">
          <thead>
            <tr>
              <th>Imagen</th>
              <th>Nombre</th>
              <th>Descripci√≥n</th>
              <th>Precio</th>
              <th>Precio Descuento</th>
              <th>Stock</th>
              <th>Categor√≠a</th>
              <th>Marca</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let product of products; trackBy: trackByProduct">
              <td>
                <div class="image-container" *ngIf="product.images && product.images.length > 0">
                  <img
                    [src]="product.images[0].url"
                    [alt]="product.name"
                    class="product-image"
                    loading="lazy">
                  <div class="image-overlay">
                    <span class="view-icon">üëÅÔ∏è</span>
                  </div>
                </div>
                <div class="no-image" *ngIf="!product.images || product.images.length === 0">
                  üì∑
                </div>
              </td>
              <td>
                <div class="product-name">{{ product.name }}</div>
              </td>
              <td>
                <div class="product-description" [title]="product.description">
                  {{ product.description }}
                </div>
              </td>
              <td>
                <div class="product-price">
                  {{ product.price | currency:'S/. ':'symbol':'1.2-2' }}
                </div>
              </td>
              <td>
                <div class="product-price" *ngIf="product.priceDiscount && product.priceDiscount > 0">
                  {{ product.priceDiscount | currency:'S/. ':'symbol':'1.2-2' }}
                </div>
                <div *ngIf="!product.priceDiscount || product.priceDiscount === 0">-</div>
              </td>
              <td>
                <span class="stock-badge" [class]="getStockClass(product.stock)">
                  {{ product.stock }}
                </span>
              </td>
              <td>
                <span class="category-badge">{{ product.categoryName }}</span>
              </td>
              <td>
                <span class="brand-badge">{{ product.brandName || '-' }}</span>
              </td>
              <td class="actions">
                <div class="action-buttons">
                  <button
                    type="button"
                    class="btn btn-primary btn-small"
                    (click)="editProduct(product.id)"
                    [disabled]="isLoading"
                    title="Editar producto">
                    ‚úèÔ∏è
                  </button>
                  <button
                    type="button"
                    class="btn btn-danger btn-small"
                    (click)="deleteProduct(product.id)"
                    [disabled]="isLoading"
                    title="Eliminar producto">
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="!isLoading && !hasProducts" class="no-data">
        <div class="no-data-icon">üì¶</div>
        <h3>No hay productos disponibles</h3>
        <p>Agrega tu primer producto usando el formulario de arriba</p>
      </div>

      <!-- Paginaci√≥n -->
      <div class="pagination" *ngIf="!isLoading && hasProducts && totalPages > 1">
        <button
          class="btn btn-secondary btn-small"
          (click)="previousPage()"
          [disabled]="!canGoPrevious">
          ‚¨ÖÔ∏è Anterior
        </button>

        <div class="pagination-numbers">
          <button
            *ngFor="let page of getPageNumbers()"
            class="btn btn-page"
            [class.active]="page === currentPage"
            (click)="goToPage(page)">
            {{ page + 1 }}
          </button>
        </div>

        <div class="pagination-info">{{ paginationInfo }}</div>

        <button
          class="btn btn-secondary btn-small"
          (click)="nextPage()"
          [disabled]="!canGoNext">
          Siguiente ‚û°Ô∏è
        </button>
      </div>
    </div>
  </div>
</div>
