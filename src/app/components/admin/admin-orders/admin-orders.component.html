<app-admin-sidebar></app-admin-sidebar>
<div class="container">
  <div class="header">
    <h1>Gesti√≥n de √ìrdenes</h1>
    <p>Administra y controla todas las √≥rdenes de tu negocio</p>
  </div>

  <div class="filters">
    <div class="filters-grid">
      <div class="filter-group">
        <label for="userIdFilter">ID de Usuario</label>
        <input
          type="number"
          id="userIdFilter"
          [(ngModel)]="filters.userId"
          placeholder="Ingresa ID de usuario">
      </div>

      <div class="filter-group">
        <label for="statusFilter">Estado</label>
        <select id="statusFilter" [(ngModel)]="filters.status">
          <option *ngFor="let option of statusOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label for="startDateFilter">Fecha Inicio</label>
        <input
          type="date"
          id="startDateFilter"
          [(ngModel)]="filters.startDate"
          (change)="onStartDateChange()">
      </div>

      <div class="filter-group">
        <label for="endDateFilter">Fecha Fin</label>
        <input
          type="date"
          id="endDateFilter"
          [(ngModel)]="filters.endDate">
      </div>
    </div>

    <div class="filter-actions">
      <button class="btn btn-primary" (click)="applyFilters()">Buscar</button>
      <button class="btn btn-secondary" (click)="clearFilters()">Limpiar</button>
    </div>
  </div>

  <div class="content">
    <!-- Alert Messages -->
    <div *ngIf="alertMessage" class="alert" [class.alert-success]="alertType === 'success'" [class.alert-error]="alertType === 'error'">
      {{ alertMessage }}
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>Cargando √≥rdenes...</p>
    </div>

    <!-- Orders Content -->
    <div *ngIf="!loading">
      <!-- Empty State -->
      <div *ngIf="orders.length === 0" class="empty-state">
        <div class="empty-state-icon">üì¶</div>
        <h3>No se encontraron √≥rdenes</h3>
        <p>No hay √≥rdenes que coincidan con los filtros seleccionados</p>
      </div>

      <!-- Orders Grid -->
      <div *ngIf="orders.length > 0" class="orders-grid">
        <div *ngFor="let order of orders" class="order-card">
          <div class="order-header">
            <div class="order-id">Orden #{{ order.id }}</div>
            <div class="order-status" [class]="getStatusClass(order.status)">
              {{ order.status }}
            </div>
          </div>

          <div class="order-info">
            <div class="info-item">
              <div class="info-label">Usuario</div>
              <div class="info-value">{{ order.userEmail }}</div>
            </div>
            <div class="info-item">
              <div class="info-label">Total</div>
              <div class="info-value">S/.{{ order.totalAmount }}</div>
            </div>
            <div class="info-item">
              <div class="info-label">Fecha</div>
              <div class="info-value">{{ formatDate(order.date) }}</div>
            </div>
          </div>

          <div class="order-products">
            <div class="products-header">Productos</div>
            <div *ngFor="let product of order.orderProducts" class="product-item">
              <div class="product-info">
                <div class="product-name">{{ product.productName }}</div>
                <div class="product-details">
                  Cantidad: {{ product.quantity }} | Precio: S/.{{ product.unitPrice }}
                </div>
              </div>
            </div>
          </div>

          <div class="order-actions">
            <button
              *ngIf="canConfirm(order.status)"
              class="btn btn-success"
              (click)="confirmOrder(order.id)">
              Confirmar
            </button>

            <button
              *ngIf="canCancel(order.status)"
              class="btn btn-danger"
              (click)="cancelOrder(order.id)">
              Cancelar
            </button>

            <button
              *ngIf="canSend(order.status)"
              class="btn btn-warning"
              (click)="sendOrder(order.id)">
              Enviar
            </button>

            <button
              *ngIf="canDeliver(order.status)"
              class="btn btn-info"
              (click)="deliverOrder(order.id)">
              Entregar
            </button>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div *ngIf="totalPages > 1" class="pagination">
        <button
          [disabled]="currentPage === 0"
          (click)="changePage(currentPage - 1)">
          ‚Üê Anterior
        </button>

        <button
          *ngFor="let page of getPageNumbers()"
          [class.active]="page === currentPage"
          (click)="changePage(page)">
          {{ page + 1 }}
        </button>

        <button
          [disabled]="currentPage >= totalPages - 1"
          (click)="changePage(currentPage + 1)">
          Siguiente ‚Üí
        </button>

        <div class="page-info">
          P√°gina {{ currentPage + 1 }} de {{ totalPages }}
          ({{ totalElements }} elementos)
        </div>
      </div>
    </div>
  </div>
</div>
